# 📚 Object-Oriented Library (OOP Library Lending Service)
도서 대출/반납/예약 기능을 객체지향적으로 설계하며 테스트 코드 작성과 리팩터링을 통해 유지보수하기 쉬운 구조를 학습하는 프로젝트입니다.   
애플리케이션은 로컬에서 실행하고 데이터베이스는 Docker로 분리해 테스트 환경을 단순화했습니다.

# 목표
- 기능이 “그냥 동작”하는 수준을 넘어 협력하는 객체 설계를 통해 변경에 강한 구조 만들기
- 테스트 코드로 설계 의도와 책임 경계를 명확히 하기

# 설계 원칙
- **단일 책임(SRP)**: 하나의 클래스는 하나의 이유로만 바뀐다.
- **개방-폐쇄(OCP)**: 기존 코드를 수정하지 않고도 새로운 기능이나 정책을 확장할 수 있도록 설계한다.
- **의존 역전(DIP)**: 상위 수준 모듈은 하위 구현에 의존하지 않도록 한다.
- **캡슐화 & 불변성**: 도메인 상태는 생성 시 유효성 보장하고 가급적 불변 객체 지향한다.
- **Tell, Don’t Ask**: 객체의 상태를 꺼내기보다 행동을 시켜 협력하게 만든다.
- **값 객체 우선**: 원시값 대신 의미 있는 타입으로 유효성과 의도를 함께 표현한다.
- **KISS & YAGNI**: 단순함을 유지하고, 지금 필요한 기능만 구현한다.

# 기능 목록

## 유스케이스 (Use Cases)

### 대출
- 목적 : 회원이 특정 소장본을 대출한다.
- 행위자 : Member
- 조건 :
  - 회원이 `ACTIVE` 상태여야 한다.
  - 소장본 상태가 `AVAILABLE` 이어야 한다.
  - 회원의 현재 대출은 정책이 허용하는 권수 이하이어야 한다.
  - 타인 예약 대기열이 존재할 때, 본인이 1순위가 아니면 대출 불가하다.
  - 연체나 패널티가 없어야 한다.
- 흐름 :
  - 시스템이 `Member`와 `StroedBook`을 조회한다.
  - `LoanPolicy`로 대출 가능 여부를 판단한다.
  - 가능하면 `Loan`을 생성하고 `StoredBook`의 상태를 업데이트 한다.
  - `LoanPolicy`로 반납 예정일을 계산하여 응답한다.

### 반납
- 목적 : 대출한 소장본을 반납한다.
- 행위자 : Member
- 조건 :
  - 대출이 존재해야 한다.
- 흐름 :
  - `Loan`을 조회한다.
  - 존재하면 반납 처리한다. (이미 반납된 경우 멱등 처리)
  - `StoredBook`의 상태를 업데이트 한다.
  - 연체시 `PenaltyPolicy`로 패널티 부여

### 연장
- 목적 : 대출 기한을 연장한다.
- 행위자 : Member
- 조건 : 
  - 대출이 진행 중이여야 한다.
  - 연체시 연장이 안된다.
  - 예약 대기열이 없어야 한다.
  - 연장 횟수를 넘어가는지 확인한다.
- 흐름 :
  - `Loan`을 조회한다.
  - `Reservation`으로 예약 대기열이 있는지 확인한다.
  - `LoanPolicy`로 연장 횟수가 넘어가는지 확인한다.
  - `Loan`의 상태를 갱신한다.

### 예약
- 목적 : 대출중인 도서를 예약한다.
- 행위자 : Member
- 조건 :
  - 회원이 `ACTIVE` 상태여야 한다.
  - 패널티가 없어야 한다.
  - 회원이 이미 해당 도서를 대출 또는 예약을 보유하지 않아야 한다.
  - 예약 대기열의 최대 인원 수를 초과하지 않아야 한다.
- 흐름 :
  - 시스템이 회원과 도서를 조회한다.
  - `StoredBook`에서 해당 도서의 소장본 상태를 확인한다.
  - 모든 소장본이 대출 중이라면 `Reservation`을 생성한다.

## 도메인

### Member
- 역할/책임 : 대출, 예약의 자격 주체이며 패널티를 일관되게 유지한다.
- 행동 : 
  - [ ] 활성 상태이면서 정책이 허용하는 범위 안에서만 대출, 예약을 할 수 있다.
  - [ ] 대출, 예약의 발생과 종료에 따라 현재 보유 건수와 제재 상태가 갱신된다.

### Book
- 역할/책임 : 책 한 권의 메타데이터를 관리하며, 여러 소장본과 예약을 아우르는 집합 루트로서 이들 간의 정책을 조율한다.
- 행동 :
  - [x] 새 책 등록 시 초기 소장본을 함께 생성한다.
  - [x] 운영 중 가용 소장본을 추가 등록한다.
  - [x] 소장본 1권을 해당 `Book`과 연관관계를 설정한다.
  - [ ] 모든 소장본이 대출 중일 때만 예약 접수를 허용한다.
  - [ ] 반납으로 가용 소장본이 생기면 예약 대기열의 선두에게 우선권이 넘어가도록 한다.

### StoredBook
- 역할/책임 : 동일 `Book`에 속한 한 권의 실물을 나타내며 `AVAILABLE`/`LOANED`/`ON_HOLD` 등 권별 상태 전이를 관리한다.
- 행동 : 
  - [x] 대출 가능일 때만 대출로 전환한다.
  - [x] 반납 시 예약 대기열이 없으면 다시 대출 가능으로 상태를 갱신한다.
  - [x] 반납 시 예약 대기열이 있으면 지정 회원의 픽업 대기로 전환된다.

### StoredBooks
- 역할/책임 : 동일 `Book`에 속한 모든 `StoredBook` 집합을 캡슐화
- 행동 :
  - [x] 유효한 소장본만 추가한다.
  - [x] 모든 소장본이 LOANED일 때만 true (예약 가능 여부 판단)
  - [x] 첫 번째 `AVAILABLE` 상태의 소장본을 조회한다.

### Loan
- 역할/책임 : 특정 `StoredBook`이 특정 `Member`에게 대출된 사실과 생명주기를 관리한다.
- 행동 :
  - [ ] 대출이 된 도서만 반납 / 연장이 가능하다.
  - [ ] 연체 중이거나 타인의 예약 대기열이 존재하면 연장을 거절한다.
  - [ ] 반납이 확정되면 그 결과가 `StoredBook`의 상태가 갱신된다.

### Reservation
- 역할/책임 : 특정 `Book`에 대해 한 회원의 단건 예약을 나타내고, 예약의 상태 전이를 관리한다.
- 행동 :
  - [x] 예약 생성 시 `QUEUED` 상태로 시작한다.
  - [x] 보류 기한과 대상 소장본을 지정하여 `HOLD_READY`로 전이할 수 있다.
  - [x] 보류 기한이 지나면 `EXPIRED`로 전이된다.
  - [x] 대출 완료 시 `LOAN_COMPLETE` 상태로 전이된다.

### Reservations
- 역할/책임 : 동일 `Book`에 대한 예약 대기열 전체를 관리한다.
- 행동 :
  - [x] 동일 회원의 중복 예약을 금지한다.
  - [x] 대기열 상한을 초과하면 예약을 거절한다.
  - [x] 선두 대기자에게 보류를 부여한다.
  - [x] 보류 기한 만료 여부를 판단하여 상태를 전이하고 만료된 소장본의 ID 목록을 반환한다.
  - [x] HOLD_READY 상태 중 특정 회원의 예약이 본인의 예약이 맞는지 조회한다.

### ReservationPolicy
- 역할/책임 : 예약 대기열 크기, 보류 기간, 소장본 선택 기준 등을 결정한다.
- 행동 : 
  - [x] 예약 대기열의 최대 크기를 반환한다.
  - [x] 예약 보류 유지 기간을 반환한다.
  - [x] 대출 가능한 소장본 중 하나를 선택한다.

### LoanPolicy
- 역할/책임 : 누가 / 무엇을 / 얼마나 / 언제까지 빌릴 수 있는지와 연장 허용 여부, 반납 기한 산정, 권수 한정 등 행동의 기준을 제공한다.
- 행동 :
  - [ ] 대출 시점과 정책에 따라 반납 예정일을 계산하고 위반 시 명확한 거절 사유를 제공한다.
  - [ ] 회원 상태, 소장본 상태, 예약 대기 상황 등을 근거로 대출 가능 여부와 연장 가능 여부를 판단한다.